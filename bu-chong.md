# Nginx指令与信号

## 指令

* 启动：直接运行nginx的可执行文件
* 停止：
  * 快速关闭：nginx -s stop 或 kill -TERM 主进程号 或 kill -INT 主进程号
  * 优雅关闭\(不接受新的连接请求，等待旧的连接请求处理完毕再关闭\)：nginx -s quit 或 kill -QUIT 主进程号
* 重新加载配置文件：nginx -s reload 或 kill -HUP 主进程号
* 测试配置文件，检查配置文件语法是否正确，然后试图打开文件涉及的配置：nginx -t
* 查看nginx版本信息： nginx -v
* 查看nginx版本信息，编译版本，和配置参数：nginx -V
* 重启日志文件，备份日志文件时常用：nginx -s reopen 或 kill -USR1 主进程号
* nginx的平滑升级：
  1. 用新的nginx可执行程序替换旧的可执行程序，即下载新的nginx，重新编译到旧版本的安装路径中（重新编译之前可以备份旧的可执行文件）
  2. 给nginx主进程号发送USR2信号，kill -USR2 旧的主进程号
  3. 给旧的主进程发送WINCH信号，kill -WINCH 旧的主进程号
  4. 给旧的主进程发送QUIT信号，使其关闭，kill -QUIT 旧的主进程号
  5. 若中途停止升级，回滚到旧的nginx，则：
     1. 给旧的主进程号发送HUP命令，此时nginx不重新读取配置文件的情况下重新启动旧主进程的工作进程，kill -HUP 旧的主进程号
     2. 优雅的关闭新的主进程，kill QUIT 新的进程号（如果由于某种原因，无法关闭新主进程的工作进程，直接给进程号发送KILL信号）

## 信号

nginx的进程分为主进程和工作进程，关于nginx的信号，主进程支持以下信号： 

* TERM，INT 快速关闭
* QUIT 优雅的关闭 
* KILL 关闭一个顽固进程 
* HUP 改变配置，使用新配置开启新的工作进程，优雅的关闭旧的进程 
* USR1 重新开启日志文件 
* USR2 平滑升级nginx 
* WINCH 优雅的关闭工作进程

单个工作进程也可以通过信号控制，但它不是必须的。单个工作进程支持的信号有：

* TERM，INT 快速关闭  
* QUIT 优雅的关闭 
* USR1 重新开启日志文件





